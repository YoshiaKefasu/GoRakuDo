---
import BaseLayout from "../layouts/BaseLayout.astro"

// Homepage specific components
import Hero from "../components/homepage/hero.astro"
import MissionSection from "../components/homepage/MissionSection.astro"
import InvitationModal from "../components/public-components/InvitationModal.vue"
import FeaturesSection from "../components/homepage/FeaturesSection.astro"
import DocumentationPreviewSection from "../components/homepage/DocumentationPreviewSection.astro"

// CSSã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import "../styles/homepage/ImageSlideshow.css"
import "../styles/homepage/index.css"
import "../styles/homepage/homepage.css"

// å‹å®‰å…¨ãªSEOãƒ‡ãƒ¼ã‚¿å®šç¾©ï¼ˆAstroãƒã‚¤ãƒ†ã‚£ãƒ–ï¼‰
interface SEOData {
  title: string;
  description: string;
  keywords: string[];
  pageType: 'website' | 'article';
  image?: string;
  author?: string;
  lang?: string; // è¨€èªè¨­å®šã‚’è¿½åŠ ï¼ˆå„ãƒšãƒ¼ã‚¸ã§è‡ªç”±ã«å¤‰æ›´å¯èƒ½ï¼‰
}

const seoData: SEOData = {
  title: "GoRakuDo - Komunitas Immersion Bahasa Jepang",
  description: "Komunitas immersion bahasa Jepang terbesar di Indonesia. Belajar bahasa Jepang dengan metode immersion yang efektif bersama ribuan pembelajar",
  keywords: ["immersion", "bahasa jepang", "otodidak bahasa jepang", "indonesia"],
  pageType: "website",
  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç”»åƒã‚’ä½¿ç”¨ï¼ˆUnifiedSEOã§è¨­å®šæ¸ˆã¿: /img/FullDC Logo.webpï¼‰
  author: "GoRakuDo Team",
  lang: "id" // ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢èªã‚’æ˜ç¤ºçš„ã«æŒ‡å®šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯'id'ã ãŒã€æ˜ç¤ºçš„ã«è¨­å®šï¼‰
}
---

<BaseLayout
  title={seoData.title}
  description={seoData.description}
  keywords={seoData.keywords}
  pageType={seoData.pageType}
  image={seoData.image}
  author={seoData.author}
  lang={seoData.lang}
  gtag={import.meta.env.PUBLIC_GA_ID}
>
  <!-- Homepage specific background elements -->
  <!-- Wave Animation Background (Hidden from screen readers) - FIXED TRANSPARENT -->
  <canvas id="waveCanvas" class="wave-canvas" aria-hidden="true"></canvas>

  <!-- Stars Background (Hidden from screen readers) - Stars will be created dynamically by the module -->
  <div class="stars" aria-hidden="true"></div>

  <!-- Main Content -->
  <main
    class="main-content"
    role="main"
    style="background: transparent !important;"
    transition:name="main-content">
    <!-- Hero Section -->
    <Hero
      missionId="mission"
      invitationModalId="invitationModal"
      titleLine1="Belajar Secara Alami,"
      titleLine2="Kuasai Layaknya Penutur Asli."
    />

    <!-- Mission Section -->
    <MissionSection />

    <!-- Features Section -->
    <FeaturesSection />

    <!-- Documentation Preview Section -->
    <DocumentationPreviewSection />
  </main>

  <!-- Invitation Modal - Load only when needed -->
  <InvitationModal client:idle />

  <script fetchpriority="auto" is:inline src="/core/hompage-script.js"></script>

  <!-- Animation Modules Integration -->
  <script>
    // Dynamic import for animation modules with comprehensive error handling
    Promise.all([import("../scripts/ui/background-animations/stars-animation.js")])
      .then(([starsModule]) => {
        console.log("ğŸ¬ Stars animation module loaded successfully")

        // Initialize stars animation only
        const starsAnimation = starsModule.initStarsAnimation({
          enabled: true,
          count: 8,
          animationDuration: "4s",
          opacity: 0.6,
          containerClass: "stars",
          starClass: "star",
          containerId: "stars",
          useExistingContainer: true,
          createContainer: false,
          containerSelector: ".stars",
          accessibility: {
            respectReducedMotion: false,
            announceChanges: false,
            screenReaderFriendly: true,
            highContrastSupport: true,
            forceEnable: true,
          },
        })

        // Start animations when page loads
        window.addEventListener("load", () => {
          try {
            // Initialize stars animation with existing container
            starsAnimation.init("stars")
            console.log("âœ¨ Stars animation initialized successfully")

            // Debug: Check if stars were created
            setTimeout(() => {
              const stars = document.querySelectorAll(".star")
              console.log(`ğŸ” Debug: Found ${stars.length} stars in DOM`)
              if (stars.length > 0) {
                console.log("âœ… Stars are visible in DOM")
              } else {
                console.log("âš ï¸ No stars found in DOM - checking container")
                const container = document.querySelector(".stars")
                console.log("Container:", container)
              }
            }, 500)

            // Add loaded class to prevent popup effect
            setTimeout(() => {
              const starsContainer = document.querySelector(".stars")
              if (starsContainer) {
                starsContainer.classList.add("loaded")
              }
            }, 100)

            // Trigger hero animation after animations are ready
            setTimeout(() => {
              const heroContent = document.querySelector("#hero-content")
              if (heroContent) {
                heroContent.classList.remove(
                  "opacity-0",
                  "translate-y-16",
                  "scale-80",
                  "blur-md"
                )
                console.log("âœ¨ Hero content revealed smoothly")
              }
            }, 200) // Coordinate with hero component timing
          } catch (error) {
            console.error("âŒ Animation initialization error:", error)
          }
        })
      })
      .catch((error) => {
        console.log("âš ï¸ Animation modules failed to load:", error.message)
        // Fallback: continue with existing inline animations
        console.log("ğŸ”„ Falling back to existing inline animations")
      })
  </script>

  <!-- Performance monitoring removed -->
  <script>
    // Intersection Observer for lazy loading optimization
    const lazyElements = document.querySelectorAll("[data-lazy]")
    const lazyObserver = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("loaded")
          lazyObserver.unobserve(entry.target)
        }
      })
    })

    lazyElements.forEach((el) => lazyObserver.observe(el))

    // Service Worker registration for caching (if available)
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        // Opt-in only: enable by setting localStorage.setItem('enable-sw','true')
        const enableSW = localStorage.getItem("enable-sw") === "true"

        if (enableSW) {
          navigator.serviceWorker
            .register("/sw.js")
            .then((registration) => {
              console.log("ğŸ”§ Service Worker registered:", registration.scope)

              // Check for updates
              registration.addEventListener("updatefound", () => {
                const installing = registration.installing
                if (!installing) return
                installing.addEventListener("statechange", () => {
                  if (
                    installing.state === "installed" &&
                    navigator.serviceWorker.controller
                  ) {
                    console.log("ğŸ”„ New Service Worker available")
                  }
                })
              })
            })
            .catch((error) => {
              console.log(
                "âš ï¸ Service Worker registration failed:",
                error?.message || error
              )
            })
        } else {
          // Disabled by default to avoid GH Pages cache/stale-content issues
          console.log(
            "ğŸ”§ Service Worker disabled (enable via localStorage 'enable-sw' = 'true')"
          )
        }
      })
    }
  </script>
</BaseLayout>
